<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>DavinciCTF 2023 Write-ups - Pinox&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Pinox&#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Pinox&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Giải DaVinciCTF năm nay mình giải được 4 bài Crypto, trong đó có 2 bài dễ không mất thời gian, và 2 bài còn lại về trao đổi khóa DHKE mình giải ra khi sắp hết giờ. Những bài này đều là những bài hay,"><meta property="og:type" content="blog"><meta property="og:title" content="DavinciCTF 2023 Write-ups"><meta property="og:url" content="https://pinox0x0.github.io/2023/davinci-ctf-2023/"><meta property="og:site_name" content="Pinox&#039;s Blog"><meta property="og:description" content="Giải DaVinciCTF năm nay mình giải được 4 bài Crypto, trong đó có 2 bài dễ không mất thời gian, và 2 bài còn lại về trao đổi khóa DHKE mình giải ra khi sắp hết giờ. Những bài này đều là những bài hay,"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://pinox0x0.github.io/src/2023/DaVinciCTF-2023/davincictf-2023-result.jpg"><meta property="article:published_time" content="2023-03-12T21:00:00.000Z"><meta property="article:modified_time" content="2023-03-24T22:00:48.106Z"><meta property="article:author" content="Pinox0x0"><meta property="article:tag" content="crypto"><meta property="article:tag" content="CTF"><meta property="article:tag" content="WriteUp"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://pinox0x0.github.io/src/2023/DaVinciCTF-2023/davincictf-2023-result.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://pinox0x0.github.io/2023/davinci-ctf-2023/"},"headline":"DavinciCTF 2023 Write-ups","image":["https://pinox0x0.github.io/src/2023/DaVinciCTF-2023/davincictf-2023-result.jpg"],"datePublished":"2023-03-12T21:00:00.000Z","dateModified":"2023-03-24T22:00:48.106Z","author":{"@type":"Person","name":"Pinox0x0"},"publisher":{"@type":"Organization","name":"Pinox's Blog","logo":{"@type":"ImageObject","url":{"text":"Pinox0x0's Blog"}}},"description":"Giải DaVinciCTF năm nay mình giải được 4 bài Crypto, trong đó có 2 bài dễ không mất thời gian, và 2 bài còn lại về trao đổi khóa DHKE mình giải ra khi sắp hết giờ. Những bài này đều là những bài hay,"}</script><link rel="canonical" href="https://pinox0x0.github.io/2023/davinci-ctf-2023/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Pinox0x0&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/tools">Tools</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-03-12T21:00:00.000Z" title="00:00:00 13/3/2023">2023-03-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-03-24T22:00:48.106Z" title="01:00:48 25/3/2023">2023-03-25</time></span><span class="level-item"><a class="link-muted" href="/categories/CTF-Write-ups/">CTF Write-ups</a></span><span class="level-item">18 minutes read (About 2764 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">DavinciCTF 2023 Write-ups</h1><div class="content"><p><img src="/src/2023/DaVinciCTF-2023/davincictf-2023-result.jpg"></p>
<p>Giải DaVinciCTF năm nay mình giải được 4 bài Crypto, trong đó có 2 bài dễ không mất thời gian, và 2 bài còn lại về trao đổi khóa DHKE mình giải ra khi sắp hết giờ. Những bài này đều là những bài hay, phải dựa vào hint ẩn mà bài nhắc đến để giải.</p>
<span id="more"></span>

<h2 id="Welcome"><a href="#Welcome" class="headerlink" title="Welcome"></a>Welcome</h2><blockquote>
<p>Welcome to the DaVinciCTF! Join the discord: <a target="_blank" rel="noopener" href="https://discord.gg/JN8JPcH3Yn">https://discord.gg/JN8JPcH3Yn</a></p>
</blockquote>
<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="Vigenere-XOR-easy-100"><a href="#Vigenere-XOR-easy-100" class="headerlink" title="Vigenere XOR (easy, 100)"></a>Vigenere XOR (easy, 100)</h2><blockquote>
<p>Leonard forgot to tell you the key he used to encrypt his message.<br>Would you be able to recover the message he sent you ?<br>Files: <code>message</code><br>Flag format: <code>dvCTF&#123;[REDACTED]&#125;</code> found in the message</p>
</blockquote>
<figure class="highlight text"><figcaption><span>message</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00011010001111010100110001110000001100000101100100100111011100100101000000100100011101010001000000010111001110100101110001110000001100100101110000100010001101010001100100111001001001110001000000100111001001000111101000000100000100100100101101111011011000100110101101100011000100000110111100001000011000010110000000001111011001010000010100011100000110010000101000001001000010110111110100011010000011010111111100000010011001010000001100001101000101100100010001111110011101000110011100100110001111100101010101110000001100000101111100101101001101110001100101110001</span><br></pre></td></tr></table></figure>

<p>Cũng chẳng có gì khó, vào trang web <a target="_blank" rel="noopener" href="https://www.dcode.fr/xor-cipher">này</a> và brute thôi. </p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You did it! The flag is dvCTF&#123;80R3D_K3Y_15_K3Y_MY_FR13ND&#125;. Well done !</span><br></pre></td></tr></table></figure>

<h2 id="Desintegrated-RSA-crypto-100"><a href="#Desintegrated-RSA-crypto-100" class="headerlink" title="Desintegrated RSA (crypto, 100)"></a>Desintegrated RSA (crypto, 100)</h2><blockquote>
<p>Leonard is starting to fell his age and his sight hasn’t been improving lately…<br>He gave me a part of his private key to decipher a message he received but he must have written 2 bits wrongely.<br>Would you be able to recover the private key for me and decipher his message please ?<br>Files: <code>my_paper</code><br>Flag format: ASCII chars<br>Don’t forget to add the <code>dvCTF&#123;&#125;</code> wrapper to your flag!</p>
</blockquote>
<figure class="highlight text"><figcaption><span>my_paper</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">e = 65537</span><br><span class="line">N = 717112095603796567459186675289085366666353307185490838112863469094236267064115095991318914077602556259092980640688481403957314611778356606590630923532172479459611664646123086735269849900884971954345014685854404613997971637479029358038777738612361656852669461942050483312357280227014477564862706358220265665684528484015675504406503642979068426662169208465726918109620002278730736582232507060863895239183614060352797915536803003766379326547455483805121183179622890875770347638754708633078401281869506937834987783549345444254985895168452303800618033133228421198570487293819512418570281720722209228656211732340633248821599038100558406541752556869957692270681816412540575428707774563875539462996182209726292786035178337626465674172053275188702251252357574867926706930607919671904054905671307852875045332721950531335900880364093157198125415400056706443026713461092993702796866382626321181134825237204434544098170777248711033815662904232551373912160599351955643630688486881346494419969742967490139650172842016964428670057727847565045461509019920640425372258450235773976492903639059374783281230558894906358850621988779071303812061651368357729631671532668073611308975396088608980146647649154262885567149667654346594998380255328428626713577833</span><br><span class="line">message = 264534650266105599806294021070614230595616525906055753733761719275657774871470140716982224248591199930143393536112109666634675797148303913100693807661342308555939532608805045967956383107966177699787072449920253895221304428097068425393162931376216861878624593868623806403407463235780480244748078241725783430590495340799442724682566190632050547591341323688977303501641184951367816544042508488494475499053434594879307412981360853044625476334885351799592910757244150652389450722949077045473797563111265917765609352389143140723484112393593857707133580845664021986531624981054608271428875875563984105161439320613210497589395084708184226072788120184187653476835755855473119021530837541643055886076234084972648710196573106365229553050082479821148344623946637161759377216826589918124913366632162149006381730172591022803075404878808812491011198771709647073141166756215048339139472055570431392757757451548399461407884147879477545478028761274883498759069612591413321559799628662445755512999075034030583300601150472018816567707188341247953317752726136118637093294082860094619153110729803351873487926928582227569644123629745035652271651297427589546895153366652555770618092604114490238897158877913219257369176494787069733353644783317504411523314154</span><br><span class="line">p = &quot;11001101110001101010110000010000100000101010010111101000000101001100011101101101101111100100111100010111010110010110011101100110100001100001001011011010101010110111111001001000100000110100011011001111101101110001101010111101011111011111011111110111110001101100001101101101101011001111100000110100101110101111000001010001011011011101001001111010001101000011110010110101111011101011001001101111111010111100001111001001001001100011001111001000000000000001100100100010010101100111010101010000010100010001010100101111101110111011100111101000110001010110010111000000000101111001100000110100001101101101100010000001010100100001111001000010001111110110010000001011001111111111111100010011100001010011110100111111000110110011000000111111110010000100001111110001000000111011000000100010001001011000110011100110111111000011111100110111001110111011010100000110110100010010110101001100111010101111011000000010011000000011000001100101000001110011101111110011001000001001001011111011000010100000110000001001100110101101000000001110111111000011000001111000111010001010110000001101000011000110000110000101000111001000001111111101101111000100100101111001110100111001100001011110010011110110101100000010110001110110110010010100000111000100010101111110010011010001100110101110100001000111101110101000011110000111110100110111010001100000100111001100111100011001101010101100011110001011100100111000010110100111010111101011001101000110010000110110011011010111111011110101100000100111101011110001111011010001000011001100000101011100011100000001100110011011110101101111110101100101110100101011110001111100010110000111111011011101000000000101010000100101110100100011000101100011001011001100111101101000000111111110111110011100001000110011100010100010011111100011110101010001101111100001101100000011101101110100100000011110111000010100000110111010111101101011011010111111010100101110111110100110110101011000010010110110111100001000010110000110000100001100011110111110101101010011001111011001011101000111001000001011001111100010010111111001111011000110001000011100101001100011&quot;</span><br></pre></td></tr></table></figure>

<p>Chỉ đơn giản là chọn 2 bytes bất kỳ và flip lại. Cũng không có gì.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">717112095603796567459186675289085366666353307185490838112863469094236267064115095991318914077602556259092980640688481403957314611778356606590630923532172479459611664646123086735269849900884971954345014685854404613997971637479029358038777738612361656852669461942050483312357280227014477564862706358220265665684528484015675504406503642979068426662169208465726918109620002278730736582232507060863895239183614060352797915536803003766379326547455483805121183179622890875770347638754708633078401281869506937834987783549345444254985895168452303800618033133228421198570487293819512418570281720722209228656211732340633248821599038100558406541752556869957692270681816412540575428707774563875539462996182209726292786035178337626465674172053275188702251252357574867926706930607919671904054905671307852875045332721950531335900880364093157198125415400056706443026713461092993702796866382626321181134825237204434544098170777248711033815662904232551373912160599351955643630688486881346494419969742967490139650172842016964428670057727847565045461509019920640425372258450235773976492903639059374783281230558894906358850621988779071303812061651368357729631671532668073611308975396088608980146647649154262885567149667654346594998380255328428626713577833</span></span><br><span class="line">p = <span class="built_in">int</span>(<span class="string">&quot;11001101110001101010110000010000100000101010010111101000000101001100011101101101101111100100111100010111010110010110011101100110100001100001001011011010101010110111111001001000100000110100011011001111101101110001101010111101011111011111011111110111110001101100001101101101101011001111100000110100101110101111000001010001011011011101001001111010001101000011110010110101111011101011001001101111111010111100001111001001001001100011001111001000000000000001100100100010010101100111010101010000010100010001010100101111101110111011100111101000110001010110010111000000000101111001100000110100001101101101100010000001010100100001111001000010001111110110010000001011001111111111111100010011100001010011110100111111000110110011000000111111110010000100001111110001000000111011000000100010001001011000110011100110111111000011111100110111001110111011010100000110110100010010110101001100111010101111011000000010011000000011000001100101000001110011101111110011001000001001001011111011000010100000110000001001100110101101000000001110111111000011000001111000111010001010110000001101000011000110000110000101000111001000001111111101101111000100100101111001110100111001100001011110010011110110101100000010110001110110110010010100000111000100010101111110010011010001100110101110100001000111101110101000011110000111110100110111010001100000100111001100111100011001101010101100011110001011100100111000010110100111010111101011001101000110010000110110011011010111111011110101100000100111101011110001111011010001000011001100000101011100011100000001100110011011110101101111110101100101110100101011110001111100010110000111111011011101000000000101010000100101110100100011000101100011001011001100111101101000000111111110111110011100001000110011100010100010011111100011110101010001101111100001101100000011101101110100100000011110111000010100000110111010111101101011011010111111010100101110111110100110110101011000010010110110111100001000010110000110000100001100011110111110101101010011001111011001011101000111001000001011001111100010010111111001111011000110001000011100101001100011&quot;</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">2046</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, <span class="number">2047</span>):</span><br><span class="line">        t = (<span class="number">1</span> &lt;&lt; i) ^ (<span class="number">1</span> &lt;&lt; j)</span><br><span class="line">        </span><br><span class="line">        s = p ^ t</span><br><span class="line">        <span class="keyword">if</span> N % s == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;p = &quot;</span>, s)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dvCTF&#123;L30n4rd_M19ht_B3_0ld_But_5t1ll_Cunn1n9&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Personal-key-easy-484"><a href="#Personal-key-easy-484" class="headerlink" title="Personal key (easy, 484)"></a>Personal key (easy, 484)</h2><blockquote>
<p>Our technical team has been able to eavesdrop and recover a conversation between Leonard and his friend as well as the decryption algorithm they use. They even made it possible to send messages to his friend after the exchange.<br>Moreover, we know from a reliable source that his friend tends to keep the same private key.<br>Would you be able to recover the message he sent to Leonard previously ?<br>Files: <code>decrypt.py</code><br>Usage:<br>python3 decrypt.py -k <code>&lt;private_shared_key&gt;</code> -iv <code>&lt;iv&gt;</code> -c <code>&lt;message&gt;</code><br>python3 decrypt.py -h for more information on the inputs.<br>Flag format: <code>dvCTF&#123;[REDACTED]&#125;</code><br>Connection info: <code>nc crypto.dvc.tf 2000</code></p>
</blockquote>
<figure class="highlight python"><figcaption><span>decrypt.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_fct</span>(<span class="params">private_key: <span class="built_in">int</span>, iv: <span class="built_in">str</span>, ciphertext: <span class="built_in">str</span></span>) :</span><br><span class="line">    derived_aes_key = hashlib.sha256(<span class="built_in">str</span>(private_key).encode(<span class="string">&#x27;ascii&#x27;</span>)).digest()</span><br><span class="line">    cipher = AES.new(derived_aes_key, AES.MODE_CBC, <span class="built_in">bytes</span>.fromhex(iv))</span><br><span class="line">    <span class="keyword">return</span> unpad(cipher.decrypt(<span class="built_in">bytes</span>.fromhex(ciphertext)),<span class="number">16</span>,<span class="string">&#x27;pkcs7&#x27;</span>).decode()</span><br><span class="line">    <span class="comment"># unpad can be remove if you don&#x27;t have the dependencies</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>() :</span><br><span class="line">    parser = argparse.ArgumentParser(description= <span class="string">&quot;returns decrypted message, AES CBC Mode encryption&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-k&quot;</span>, <span class="string">&quot;--key&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span> = <span class="string">&quot;The secret key used must be given in its integer form&quot;</span>, required=<span class="literal">True</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-iv&quot;</span>, <span class="string">&quot;--init_vector&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span> = <span class="string">&quot;iv must be given in its hex value&quot;</span>, required=<span class="literal">True</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-c&quot;</span>, <span class="string">&quot;--cipher&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span> = <span class="string">&quot;cipher must be given in its hex value&quot;</span>, required= <span class="literal">True</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    <span class="keyword">try</span> :</span><br><span class="line">        key = <span class="built_in">int</span>(args.key)</span><br><span class="line">        iv = args.init_vector</span><br><span class="line">        cipher = args.cipher</span><br><span class="line">    <span class="keyword">except</span> :</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Error in the inputs, please try -h for more infos&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        message = decrypt_fct(key, iv, cipher)</span><br><span class="line">        <span class="built_in">print</span>(message)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Please, check your inputs because decryption isn&#x27;t possible.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>Check thử kết nối với server, ta thu được đoạn thông tin sau:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># First connection</span><br><span class="line">From Leonard:</span><br><span class="line">&#123;&#x27;A&#x27;: 28495810439427941743580652043307254742357428557373902639704121489048466785354237066969773928423017411801274631601564333367938091383442370280442923983663523206964188187977487944471477312407484259882669946821281142379664003865499339919542586375615288087871250173008915454256070825132728491120897580226872039819735498708106787459903970892884435364623918607275866286354216351978334720715506683283109326820482809493944496741992591729337918984878533478103, </span><br><span class="line">&#x27;g&#x27;: 2, </span><br><span class="line">&#x27;p&#x27;: 67909058639015901521159994775573035383954459487261606166344237532826148072679017733601374658223148561768415561603664175917512048376819174420250853454732953324581854497582753829708301928284664779076154088688830021115279512578857692227479562674882071152106576596875913352557789324670379649786609825434409435255821942736505342286648408198244821312692516037516042858869576975348446692782484818336732578529321186507590599512517447475812534029481702096279&#125;</span><br><span class="line"></span><br><span class="line">From his friend:</span><br><span class="line">&#123;&#x27;B&#x27;: 5958777297152924037701869753380991463266385309786916650018293530882365971814121483536854848324475390900091298324661488252892967580225291270979534466996070980817914459680656396808275529132061312082468120893434430964919805935606562404775940844800572708717873092609026416279509731798475482209430075237376153530764430228864694515630814465606995124519286884593977342766610016458075057899234554667384037105157258488328071127322324048453301198646307937333, </span><br><span class="line">&#x27;iv&#x27;: &#x27;352f60625814348d3c74791f55491a01&#x27;, </span><br><span class="line">&#x27;message&#x27;: &#x27;3550f92f89b4a981e4fb803c2e4195512a721cef7698a1d10da7afb8d5325226553b176a468f2fae2716ecb9cc02b810112064ea409aadb95c3848526746d3d1&#x27;&#125;</span><br><span class="line"></span><br><span class="line">You can now speak with Leonard&#x27;s friend: the accepted format is a dictionnary in json format: &#123;&quot;A&quot;: &lt;integer&gt;, &quot;g&quot;: &lt;integer&gt;, &quot;p&quot;: &lt;integer&gt;&#125;</span><br><span class="line">&#123;&quot;A&quot;: 28495810439427941743580652043307254742357428557373902639704121489048466785354237066969773928423017411801274631601564333367938091383442370280442923983663523206964188187977487944471477312407484259882669946821281142379664003865499339919542586375615288087871250173008915454256070825132728491120897580226872039819735498708106787459903970892884435364623918607275866286354216351978334720715506683283109326820482809493944496741992591729337918984878533478103, </span><br><span class="line">&quot;g&quot;: 2, </span><br><span class="line">&quot;p&quot;: 55938199274440651808400169480277145310129203776384790123030426966266470781983277388615243836675492161588404195754822829434964198754883125404333712190912521088233281991969967904330602449829475994315793698600639312983932507743226893469758343815241554811298112532161401686144307632304633229321887364267590546755374100808072455065916443104238779625297200385725848287859722375292203647697013541803189116253024069989174714860163693232210878024031780891373&#125;</span><br><span class="line">Received from his friend:</span><br><span class="line">&#123;&#x27;B&#x27;: 46220300434264812861438768027863424425103234948207240276710685798908763907865942524495490514495194806431790366288187212218271985917067514452414499454443119597756533934107608719546891047619822837648838472402279680608918309196713991187242724785785786115123996684936608984516266322647963102038073445852786897428852883328103558089075893335140324024615390186853105794444184349348949569542056127527373095371415479729996910985341371634846472649916257642396&#125;</span><br><span class="line"></span><br><span class="line"># Second connection</span><br><span class="line">From Leonard:</span><br><span class="line">&#123;&#x27;A&#x27;: 52428026319599185489635741560203305858485491199790610653957111011706389382868940621130747160711393007135731557349015022983393851106287127226431586686264577139296958680212594141845892105312277656430909577380050570920224174146168229047141796068473255274075749717954913415486871912565513186300935628194430042006973551101147532073079275285552486023753910626489511862686267100494063368708259733097656200052079583303871452672417541929834801232333230448435, </span><br><span class="line">&#x27;g&#x27;: 2, </span><br><span class="line">&#x27;p&#x27;: 67909058639015901521159994775573035383954459487261606166344237532826148072679017733601374658223148561768415561603664175917512048376819174420250853454732953324581854497582753829708301928284664779076154088688830021115279512578857692227479562674882071152106576596875913352557789324670379649786609825434409435255821942736505342286648408198244821312692516037516042858869576975348446692782484818336732578529321186507590599512517447475812534029481702096279&#125;</span><br><span class="line"></span><br><span class="line">From his friend:</span><br><span class="line">&#123;&#x27;B&#x27;: 5958777297152924037701869753380991463266385309786916650018293530882365971814121483536854848324475390900091298324661488252892967580225291270979534466996070980817914459680656396808275529132061312082468120893434430964919805935606562404775940844800572708717873092609026416279509731798475482209430075237376153530764430228864694515630814465606995124519286884593977342766610016458075057899234554667384037105157258488328071127322324048453301198646307937333, </span><br><span class="line">&#x27;iv&#x27;: &#x27;51c795839e99e7b5b4f85e5e429fe4fd&#x27;, </span><br><span class="line">&#x27;message&#x27;: &#x27;2342b518f7ef7ef73ce85c92e1d242c7ff3e0aff19e54b4de5632932c15063830f3147a006486d737149ac9bd9f56b63b14000747b2f435e940c70f3c9334eb3&#x27;&#125;</span><br><span class="line"></span><br><span class="line">You can now speak with Leonard&#x27;s friend: the accepted format is a dictionnary in json format: &#123;&quot;A&quot;: &lt;integer&gt;, &quot;g&quot;: &lt;integer&gt;, &quot;p&quot;: &lt;integer&gt;&#125;</span><br><span class="line">&#123;&quot;A&quot;: 52428026319599185489635741560203305858485491199790610653957111011706389382868940621130747160711393007135731557349015022983393851106287127226431586686264577139296958680212594141845892105312277656430909577380050570920224174146168229047141796068473255274075749717954913415486871912565513186300935628194430042006973551101147532073079275285552486023753910626489511862686267100494063368708259733097656200052079583303871452672417541929834801232333230448435, </span><br><span class="line">&quot;g&quot;: 2, </span><br><span class="line">&quot;p&quot;: 67909058639015901521159994775573035383954459487261606166344237532826148072679017733601374658223148561768415561603664175917512048376819174420250853454732953324581854497582753829708301928284664779076154088688830021115279512578857692227479562674882071152106576596875913352557789324670379649786609825434409435255821942736505342286648408198244821312692516037516042858869576975348446692782484818336732578529321186507590599512517447475812534029481702096549&#125;</span><br><span class="line">Received from his friend:</span><br><span class="line">&#123;&#x27;B&#x27;: 24232949087408601227993088107046604889023588772483337371158596374830398061136314870334085212681096751633551655012226041538173162269608480974541637107137623548917827986112594956218139496238240576386137123182279388825720678908979088327870636936163503406106334848025458155927428049099320243104440121811853057823375593714020877254975267418817139932607971909860849957970178836618173012567644006562215518742508540687598009638099544280541788742619996036520&#125;</span><br></pre></td></tr></table></figure>

<p>Những yêu cầu đối với bộ <code>&#123;&quot;A&quot;: &lt;int&gt;, &quot;g&quot;: &lt;int&gt;, &quot;p&quot;: &lt;int&gt;&#125;</code> như sau:</p>
<ul>
<li><em>A</em> là public key của Leonard, <em>PK</em> này trong lần đầu và lần thứ 2 nói chuyện phải <strong>giống nhau</strong>;</li>
<li><em>g</em> luôn nhận giá trị 2;</li>
<li><em>p</em> là 1 số nguyên tố, nhận giá trị không bé hơn <em>A</em>.</li>
</ul>
<p>Đến đây thì mình đã nghĩ đến sơ đồ truyền khóa DHKE, nhận thấy kết quả trả về lần nói chuyện thứ 2 khả năng cao là giá trị <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi>s</mi><msub><mi>k</mi><mi>b</mi></msub></mrow></msup><mtext> </mtext><mo stretchy="false">(</mo><mtext>mod </mtext><msub><mi>p</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">2^{sk_{b}}\,(\text{mod } p_{new})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0991079999999998em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.03148em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">mod </span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, trong đó <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{new}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> là số nguyên tố mà ta có thể chọn để có thể dễ dàng tính được <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><msub><mi>k</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">sk_{b}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, ở đây ưu tiên số nguyên tố mà <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> phân tích được thành nhân tử là những số nguyên tố bé, sau đó sử dụng CRT để tìm <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><msub><mi>k</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">sk_{b}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ban đầu.</p>
<p>Trong bài này mình đã chọn số nguyên tố sau: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p = 55938199274440651808400169480277145310129203776384790123030426966266470781983277388615243836675492161588404195754822829434964198754883125404333712190912521088233281991969967904330602449829475994315793698600639312983932507743226893469758343815241554811298112532161401686144307632304633229321887364267590546755374100808072455065916443104238779625297200385725848287859722375292203647697013541803189116253024069989174714860163693232210878024031780891373 </span><br><span class="line">= 1 + 2^2 * 37 * 43 * 151 * 331 * 337 * 367 * 439 * 487 * 523 * 773 * 1019 * 1249 * 1559 * 2999 * 4567 * 4597 * 6841 * 7523 * 7877 * 9067 * 10093 * 10459 * 10567 * 10607 * 11059 * 11071 * 11311 * 12959 * 13033 * 14143 * 14479 * 14957 * 15467 * 16673 * 21059 * 23063 * 23879 * 24229 * 25111 * 25391 * 26723 * 26921 * 27059 * 28597 * 28703 * 29587 * 30817 * 32261 * 34127 * 35069 * 35677 * 35897 * 39631 * 39703 * 43391 * 44249 * 44701 * 49477 * 49939 * 54163 * 54601 * 55313 * 57059 * 58481 * 58537 * 60293 * 60449 * 60953 * 61463 * 61909 * 62873 * 64579 * 65587 * 65881 * 70199 * 72161 * 73757 * 73877 * 75013 * 75209 * 75707 * 75979 * 77621 * 79153 * 83719 * 86239 * 88493 * 90271 * 104033 * 107351 * 108631 * 111509 * 145799 * 164191 * 164231 * 166259 * 170239 * 176299 * 178753 * 183823 * 188417 * 200899 * 766531</span><br></pre></td></tr></table></figure>

<p>Tìm B’s <em>secret key</em>  qua giải CRT (phương pháp tìm <em>Discrete Logarithm</em> khi đã biết rõ factor của  trong Theory number):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">55938199274440651808400169480277145310129203776384790123030426966266470781983277388615243836675492161588404195754822829434964198754883125404333712190912521088233281991969967904330602449829475994315793698600639312983932507743226893469758343815241554811298112532161401686144307632304633229321887364267590546755374100808072455065916443104238779625297200385725848287859722375292203647697013541803189116253024069989174714860163693232210878024031780891373</span></span><br><span class="line"></span><br><span class="line">F = [<span class="number">2</span>, <span class="number">37</span>, <span class="number">43</span>, <span class="number">151</span>, <span class="number">331</span>, <span class="number">337</span>, <span class="number">367</span>, <span class="number">439</span>, <span class="number">487</span>, <span class="number">523</span>, <span class="number">773</span>, <span class="number">1019</span>, <span class="number">1249</span>, <span class="number">1559</span>, <span class="number">2999</span>, <span class="number">4567</span>, <span class="number">4597</span>, <span class="number">6841</span>, <span class="number">7523</span>, <span class="number">7877</span>, <span class="number">9067</span>, <span class="number">10093</span>, <span class="number">10459</span>, <span class="number">10567</span>, <span class="number">10607</span>, <span class="number">11059</span>, <span class="number">11071</span>, <span class="number">11311</span>, <span class="number">12959</span>, <span class="number">13033</span>, <span class="number">14143</span>, <span class="number">14479</span>, <span class="number">14957</span>, <span class="number">15467</span>, <span class="number">16673</span>, <span class="number">21059</span>, <span class="number">23063</span>, <span class="number">23879</span>, <span class="number">24229</span>, <span class="number">25111</span>, <span class="number">25391</span>, <span class="number">26723</span>, <span class="number">26921</span>, <span class="number">27059</span>, <span class="number">28597</span>, <span class="number">28703</span>, <span class="number">29587</span>, <span class="number">30817</span>, <span class="number">32261</span>, <span class="number">34127</span>, <span class="number">35069</span>, <span class="number">35677</span>, <span class="number">35897</span>, <span class="number">39631</span>, <span class="number">39703</span>, <span class="number">43391</span>, <span class="number">44249</span>, <span class="number">44701</span>, <span class="number">49477</span>, <span class="number">49939</span>, <span class="number">54163</span>, <span class="number">54601</span>, <span class="number">55313</span>, <span class="number">57059</span>, <span class="number">58481</span>, <span class="number">58537</span>, <span class="number">60293</span>, <span class="number">60449</span>, <span class="number">60953</span>, <span class="number">61463</span>, <span class="number">61909</span>, <span class="number">62873</span>, <span class="number">64579</span>, <span class="number">65587</span>, <span class="number">65881</span>, <span class="number">70199</span>, <span class="number">72161</span>, <span class="number">73757</span>, <span class="number">73877</span>, <span class="number">75013</span>, <span class="number">75209</span>, <span class="number">75707</span>, <span class="number">75979</span>, <span class="number">77621</span>, <span class="number">79153</span>, <span class="number">83719</span>, <span class="number">86239</span>, <span class="number">88493</span>, <span class="number">90271</span>, <span class="number">104033</span>, <span class="number">107351</span>, <span class="number">108631</span>, <span class="number">111509</span>, <span class="number">145799</span>, <span class="number">164191</span>, <span class="number">164231</span>, <span class="number">166259</span>, <span class="number">170239</span>, <span class="number">176299</span>, <span class="number">178753</span>, <span class="number">183823</span>, <span class="number">188417</span>, <span class="number">200899</span>, <span class="number">766531</span>]</span><br><span class="line">g = <span class="number">2</span></span><br><span class="line">B = <span class="number">46220300434264812861438768027863424425103234948207240276710685798908763907865942524495490514495194806431790366288187212218271985917067514452414499454443119597756533934107608719546891047619822837648838472402279680608918309196713991187242724785785786115123996684936608984516266322647963102038073445852786897428852883328103558089075893335140324024615390186853105794444184349348949569542056127527373095371415479729996910985341371634846472649916257642396</span></span><br><span class="line"></span><br><span class="line">r = []</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> F:</span><br><span class="line">    q = (p - <span class="number">1</span>) // n</span><br><span class="line">    B1 = <span class="built_in">pow</span>(B, q, p)</span><br><span class="line"></span><br><span class="line">    g1 = <span class="built_in">pow</span>(g, q, p)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">pow</span>(g1, i, p) == B1:</span><br><span class="line">            r.append(i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;r = &quot;</span>, r)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><figcaption><span>sagemath</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">F = [<span class="number">4</span>, <span class="number">37</span>, <span class="number">43</span>, <span class="number">151</span>, <span class="number">331</span>, <span class="number">337</span>, <span class="number">367</span>, <span class="number">439</span>, <span class="number">487</span>, <span class="number">523</span>, <span class="number">773</span>, <span class="number">1019</span>, <span class="number">1249</span>, <span class="number">1559</span>, <span class="number">2999</span>, <span class="number">4567</span>, <span class="number">4597</span>, <span class="number">6841</span>, <span class="number">7523</span>, <span class="number">7877</span>, <span class="number">9067</span>, <span class="number">10093</span>, <span class="number">10459</span>, <span class="number">10567</span>, <span class="number">10607</span>, <span class="number">11059</span>, <span class="number">11071</span>, <span class="number">11311</span>, <span class="number">12959</span>, <span class="number">13033</span>, <span class="number">14143</span>, <span class="number">14479</span>, <span class="number">14957</span>, <span class="number">15467</span>, <span class="number">16673</span>, <span class="number">21059</span>, <span class="number">23063</span>, <span class="number">23879</span>, <span class="number">24229</span>, <span class="number">25111</span>, <span class="number">25391</span>, <span class="number">26723</span>, <span class="number">26921</span>, <span class="number">27059</span>, <span class="number">28597</span>, <span class="number">28703</span>, <span class="number">29587</span>, <span class="number">30817</span>, <span class="number">32261</span>, <span class="number">34127</span>, <span class="number">35069</span>, <span class="number">35677</span>, <span class="number">35897</span>, <span class="number">39631</span>, <span class="number">39703</span>, <span class="number">43391</span>, <span class="number">44249</span>, <span class="number">44701</span>, <span class="number">49477</span>, <span class="number">49939</span>, <span class="number">54163</span>, <span class="number">54601</span>, <span class="number">55313</span>, <span class="number">57059</span>, <span class="number">58481</span>, <span class="number">58537</span>, <span class="number">60293</span>, <span class="number">60449</span>, <span class="number">60953</span>, <span class="number">61463</span>, <span class="number">61909</span>, <span class="number">62873</span>, <span class="number">64579</span>, <span class="number">65587</span>, <span class="number">65881</span>, <span class="number">70199</span>, <span class="number">72161</span>, <span class="number">73757</span>, <span class="number">73877</span>, <span class="number">75013</span>, <span class="number">75209</span>, <span class="number">75707</span>, <span class="number">75979</span>, <span class="number">77621</span>, <span class="number">79153</span>, <span class="number">83719</span>, <span class="number">86239</span>, <span class="number">88493</span>, <span class="number">90271</span>, <span class="number">104033</span>, <span class="number">107351</span>, <span class="number">108631</span>, <span class="number">111509</span>, <span class="number">145799</span>, <span class="number">164191</span>, <span class="number">164231</span>, <span class="number">166259</span>, <span class="number">170239</span>, <span class="number">176299</span>, <span class="number">178753</span>, <span class="number">183823</span>, <span class="number">188417</span>, <span class="number">200899</span>, <span class="number">766531</span>]</span><br><span class="line">r = [<span class="number">1</span>, <span class="number">32</span>, <span class="number">10</span>, <span class="number">119</span>, <span class="number">164</span>, <span class="number">89</span>, <span class="number">91</span>, <span class="number">433</span>, <span class="number">137</span>, <span class="number">85</span>, <span class="number">63</span>, <span class="number">190</span>, <span class="number">779</span>, <span class="number">207</span>, <span class="number">2093</span>, <span class="number">748</span>, <span class="number">2412</span>, <span class="number">6520</span>, <span class="number">1580</span>, <span class="number">1606</span>, <span class="number">8288</span>, <span class="number">5002</span>, <span class="number">8768</span>, <span class="number">3876</span>, <span class="number">7635</span>, <span class="number">4201</span>, <span class="number">5108</span>, <span class="number">7928</span>, <span class="number">5784</span>, <span class="number">10692</span>, <span class="number">13308</span>, <span class="number">10449</span>, <span class="number">2913</span>, <span class="number">15147</span>, <span class="number">12642</span>, <span class="number">479</span>, <span class="number">10016</span>, <span class="number">14291</span>, <span class="number">19594</span>, <span class="number">8661</span>, <span class="number">19357</span>, <span class="number">24547</span>, <span class="number">26520</span>, <span class="number">6333</span>, <span class="number">2412</span>, <span class="number">13819</span>, <span class="number">12593</span>, <span class="number">1219</span>, <span class="number">30943</span>, <span class="number">17347</span>, <span class="number">14880</span>, <span class="number">5065</span>, <span class="number">30718</span>, <span class="number">34264</span>, <span class="number">28959</span>, <span class="number">26175</span>, <span class="number">36543</span>, <span class="number">4563</span>, <span class="number">900</span>, <span class="number">41850</span>, <span class="number">47097</span>, <span class="number">41697</span>, <span class="number">9499</span>, <span class="number">34293</span>, <span class="number">49142</span>, <span class="number">37764</span>, <span class="number">48600</span>, <span class="number">3120</span>, <span class="number">47070</span>, <span class="number">9274</span>, <span class="number">52064</span>, <span class="number">42558</span>, <span class="number">51797</span>, <span class="number">30467</span>, <span class="number">28304</span>, <span class="number">69570</span>, <span class="number">48900</span>, <span class="number">48283</span>, <span class="number">57321</span>, <span class="number">58258</span>, <span class="number">25109</span>, <span class="number">72146</span>, <span class="number">70627</span>, <span class="number">7754</span>, <span class="number">46847</span>, <span class="number">47820</span>, <span class="number">4597</span>, <span class="number">82377</span>, <span class="number">38675</span>, <span class="number">103918</span>, <span class="number">41510</span>, <span class="number">61978</span>, <span class="number">32580</span>, <span class="number">14256</span>, <span class="number">159132</span>, <span class="number">30688</span>, <span class="number">80680</span>, <span class="number">166901</span>, <span class="number">173775</span>, <span class="number">70604</span>, <span class="number">78878</span>, <span class="number">47379</span>, <span class="number">20095</span>, <span class="number">193903</span>]</span><br><span class="line"></span><br><span class="line">b = crt(r, F)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;b = &quot;</span>, b) </span><br><span class="line"><span class="comment"># b = 9535440534258834121769569640499199561934282982790658252497837758809914458523729733418481304164992451274002723885772431265722323740597782168022676885255332109588519834413479447317457536202413819036024174400848981510769214886522790679151083510608905168377452971272621393851051993304455040449956990493245272199310314449211707436470794201546430018277011169649323905791913735882824727299802350608943156549141657833006376646183171395401386535369942013201</span></span><br><span class="line"><span class="comment"># b = 65473639808699485930169739120776344872063486759175448375528264725076385240507007122033725140840484612862406919640595260700686522495480907572356389076167853197821801826383447351648059986031889813351817873001488294494701722629749684148909427325850459979675565503434023079995359625609088269771844354760835818954684415257284162502387237305785209643574211555375172193651636111175028374996815892412132272802165727822181091506346864627612264559401722904573</span></span><br></pre></td></tr></table></figure>

<p>Mình vừa nhận ra mình đã bỏ quên 1 chi tiết quan trọng nữa, đó là số nguyên tố mình chọn nhỏ hơn <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span></span></span></span> ban đầu, do đó <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><msub><mi>k</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">sk_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> có thể nhận 2 giá trị là <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><msub><mi>k</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">sk_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> và <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><msub><mi>k</mi><mi>b</mi></msub><mo>+</mo><msub><mi>p</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub></mrow><annotation encoding="application/x-tex">sk_b  + p_{new}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord mathnormal">s</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, và mình đã đúng.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_fct</span>(<span class="params">private_key: <span class="built_in">int</span>, iv: <span class="built_in">str</span>, ciphertext: <span class="built_in">str</span></span>) :</span><br><span class="line">    derived_aes_key = hashlib.sha256(<span class="built_in">str</span>(private_key).encode(<span class="string">&#x27;ascii&#x27;</span>)).digest()</span><br><span class="line">    cipher = AES.new(derived_aes_key, AES.MODE_CBC, <span class="built_in">bytes</span>.fromhex(iv))</span><br><span class="line">    <span class="keyword">return</span> unpad(cipher.decrypt(<span class="built_in">bytes</span>.fromhex(ciphertext)),<span class="number">16</span>,<span class="string">&#x27;pkcs7&#x27;</span>).decode()</span><br><span class="line">    <span class="comment"># unpad can be remove if you don&#x27;t have the dependencies</span></span><br><span class="line"></span><br><span class="line">key    = <span class="number">33730236562858783079318804195298648719433949503171998744899006924279883641693998359987336249544481786268873611104231518373922791724577950286599631818965699426098433443505567998054674692816255431379437027966857897365726813356426107575974634463162905059625954223449434339174521876537018901019912447313534000308524739195811097809736962917373301383256547982444688204397607029340080842113725598762021026158263161844463037655676011936365809824949211118258</span></span><br><span class="line">iv     = <span class="string">&quot;352f60625814348d3c74791f55491a01&quot;</span></span><br><span class="line">cipher = <span class="string">&quot;3550f92f89b4a981e4fb803c2e4195512a721cef7698a1d10da7afb8d5325226553b176a468f2fae2716ecb9cc02b810112064ea409aadb95c3848526746d3d1&quot;</span></span><br><span class="line"></span><br><span class="line">message = decrypt_fct(key, iv, cipher)</span><br><span class="line"><span class="built_in">print</span>(message)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dvCTF&#123;0M6_1_5h0u1d_Ch4n63_M9_K39_F0r_34ch_3xch4n63!&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Da-Vinci’s-Clock-medium-500"><a href="#Da-Vinci’s-Clock-medium-500" class="headerlink" title="Da Vinci’s Clock (medium, 500)"></a>Da Vinci’s Clock (medium, 500)</h2><blockquote>
<p>Leonard and his friend are discussing but his friend can’t help but brag about the speed of his new computer.<br>As part of an investigation, we managed to eavesdrop a part of their exchange and recovered a dump of his friend’s memory.<br>The memory got a bit corrupted during the extraction but would you be able to recover the intercepted message ?<br>Files: <code>chall.py</code>; <code>intercepted_message</code>; <code>memory_dump</code><br>Flag format: <code>dvCTF&#123;FLAG&#125;</code></p>
</blockquote>
<figure class="highlight python"><figcaption><span>chall.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, inverse</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tonelli_shanks <span class="keyword">import</span> tonelli_shanks</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">Point = namedtuple(<span class="string">&quot;Point&quot;</span>, <span class="string">&quot;x y&quot;</span>)</span><br><span class="line">O = <span class="string">&#x27;Origin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">point_inverse</span>(<span class="params">P: <span class="built_in">tuple</span></span>):</span><br><span class="line">    <span class="keyword">if</span> P == O:</span><br><span class="line">        <span class="keyword">return</span> P</span><br><span class="line">    <span class="keyword">return</span> Point(P.x, -P.y % p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">point_addition</span>(<span class="params">P: <span class="built_in">tuple</span>, Q: <span class="built_in">tuple</span></span>):</span><br><span class="line">    <span class="keyword">if</span> P == O:</span><br><span class="line">        <span class="keyword">return</span> Q</span><br><span class="line">    <span class="keyword">elif</span> Q == O:</span><br><span class="line">        <span class="keyword">return</span> P</span><br><span class="line">    <span class="keyword">elif</span> Q == point_inverse(P):</span><br><span class="line">        <span class="keyword">return</span> O</span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># approx. time around 30µs when entering else&#x27;s segment</span></span><br><span class="line">        <span class="keyword">if</span> P == Q:</span><br><span class="line">            aux = ((<span class="number">3</span>*P.x**<span class="number">2</span> + a) * inverse(<span class="number">2</span>*P.y, p))%p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            aux = ((Q.y - P.y) * inverse((Q.x - P.x), p))%p</span><br><span class="line">    Rx = (aux**<span class="number">2</span> - P.x - Q.x) % p</span><br><span class="line">    Ry = (aux*(P.x - Rx) - P.y) % p</span><br><span class="line">    R = Point(Rx, Ry)</span><br><span class="line">    <span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">double_and_add</span>(<span class="params">P: <span class="built_in">tuple</span>, n: <span class="built_in">int</span></span>):</span><br><span class="line">    Q = P</span><br><span class="line">    R = O</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">            R = point_addition(R, Q)</span><br><span class="line">        Q = point_addition(Q, Q)</span><br><span class="line">        n = n // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line">FLAG = <span class="string">b&quot;[REDACTED]&quot;</span> </span><br><span class="line"></span><br><span class="line">p = <span class="number">0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF</span></span><br><span class="line">a = <span class="number">0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC</span></span><br><span class="line">b = <span class="number">0x5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B</span></span><br><span class="line">G = Point(<span class="number">0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296</span>, <span class="number">0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5</span>)</span><br><span class="line">n = <span class="number">0xFFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Leonard&#x27;s public key</span></span><br><span class="line">leonard_public_key = <span class="number">31663442885885219669071274428005652588471134165143253841118506078548146970109</span></span><br><span class="line">leonard_public_point = Point(leonard_public_key, tonelli_shanks((leonard_public_key**<span class="number">3</span> + a*leonard_public_key + b)%p,p)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># My private key</span></span><br><span class="line">my_private_key = random.randint(<span class="number">2</span>**(<span class="number">243</span>),<span class="number">2</span>**<span class="number">244</span>-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># My public key:</span></span><br><span class="line">my_public_key = double_and_add(G, my_private_key).x</span><br><span class="line"><span class="built_in">print</span>(my_public_key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Our shared private key:</span></span><br><span class="line">begin = time()</span><br><span class="line">shared_secret_key = double_and_add(leonard_public_point, my_private_key).x</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">999999</span>) : <span class="comment"># I want to be precise on the computing time, i&#x27;ve even gave you the time it takes to run the function above!</span></span><br><span class="line">    double_and_add(leonard_public_point, my_private_key)</span><br><span class="line">computing_time = (time() - begin)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;You can be proud I can compute my message in less than &#123;&#125;microsec&quot;</span>.<span class="built_in">format</span>(computing_time))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Encryption of my message</span></span><br><span class="line">derived_aes_key = sha256(<span class="built_in">str</span>(shared_secret_key).encode(<span class="string">&#x27;ascii&#x27;</span>)).digest()</span><br><span class="line">iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">cipher = AES.new(derived_aes_key, AES.MODE_CBC, iv)</span><br><span class="line">ciphertext = cipher.encrypt(pad(FLAG,<span class="number">16</span>,<span class="string">&#x27;pkcs7&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(iv.<span class="built_in">hex</span>())</span><br><span class="line"><span class="built_in">print</span>(ciphertext.<span class="built_in">hex</span>())</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><figcaption><span>intercepted_message</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">38483999891907407175443591517451416704302242042818884161505760394826326870371    # public_key</span><br><span class="line">You can be proud I can compute my message in less than 10743.747201579188microsec</span><br><span class="line">2db22c78c2ed85ca292cd68abe025abc                                    # iv</span><br><span class="line">b4a5e98ab7e8f092dcacf1798bd6c95972c5a06b3a9caa537bcdf872f7da46ce    # ciphertext</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><figcaption><span>memory_dump</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">                  .             </span><br><span class="line">                   !            </span><br><span class="line">                   D            </span><br><span class="line">                                </span><br><span class="line">         p      6         7     </span><br><span class="line">                                </span><br><span class="line">      l        Q               E</span><br><span class="line">                         J      </span><br><span class="line">       i                        </span><br><span class="line"> h         </span><br><span class="line">                     *          </span><br><span class="line">                                </span><br><span class="line">       `         </span><br><span class="line">0000?111:1?1?0?00:10?10010:101011?1:011?1?10:10111111:1011??10:1?110001:10111101:1001101?:00?01111:0010?001:10000111:1?010110:10?001??:11111000:</span><br><span class="line">0010010?:??000?10:0101010?:1111?010:10001?01:0?0???1?:?0?1110?:100?0?10:100101?0:?11111?1:0111010?:0??10?10:01111100:??11?1?1:1?0?0111</span><br><span class="line">   d                            </span><br><span class="line">                 :              </span><br><span class="line">           4                    </span><br><span class="line">       5               </span><br><span class="line">                  +             </span><br><span class="line">  V                             </span><br><span class="line">                    ;           </span><br><span class="line">    K               Y           </span><br><span class="line">                        P       </span><br><span class="line">         S          y  e      % </span><br><span class="line">        5                       </span><br><span class="line">           Q                    </span><br><span class="line">            M  S                </span><br><span class="line">          c          =         ]</span><br><span class="line">            E            R&#123;     </span><br><span class="line">                 </span><br><span class="line">&gt;                )              </span><br><span class="line">           G      &quot;             </span><br><span class="line">     </span><br></pre></td></tr></table></figure>

<p>Bài này lại là bài trao đổi khóa trong Elliptic Curve (EC), việc đầu tiên chúng ta làm là check order của EC  và của Point G. Tuy nhiên kết quả lại không khả quan cho lắm:</p>
<figure class="highlight python"><figcaption><span>Sagemath</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC</span></span><br><span class="line">b = <span class="number">0x5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B</span></span><br><span class="line">p = <span class="number">0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF</span></span><br><span class="line">F = GF(p)</span><br><span class="line">E = EllipticCurve(F, [a, b])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ordE = E.order()	# 115792089210356248762697446949407573529996955224135760342422259061068512044369 -- prime</span></span><br><span class="line"><span class="comment"># print(ordE) </span></span><br><span class="line"></span><br><span class="line">G = E(<span class="number">0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296</span>, <span class="number">0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5</span>)</span><br><span class="line">ordG = G.order()	<span class="comment"># 115792089210356248762697446949407573529996955224135760342422259061068512044369 = ordE</span></span><br><span class="line"><span class="built_in">print</span>(ordG)</span><br></pre></td></tr></table></figure>

<p>Kết quả cho chúng ta chính bằng <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span> và là 1 số nguyên tố lớn, do đó ta không thể áp dụng Smart’s Attack hay Pohlig-Hellman ‘s Attack trong case này được. </p>
<p>Tuy nhiên trong <code>memory dump</code> chúng ta nhận thấy có 1 đoạn bit dài 48-bit, suy nghĩ ban đầu cho chúng ta thấy đây chính là <code>my_private_key</code> trong vùng nhớ. Ta cần private key dài 44-bit, nhưng ở trong chuỗi này có 48-bit bị hỏng, ý tưởng ban đầu của mình đơn giản thôi: vì đoạn 44-bit này bit đầu tiên có nghĩa, nên chúng ta cho bit đầu tiên giá trị 1, còn lại 47 bit thì ta brute :D Tuy nhiên thời gian cần thiết để tính là quá dài, do đó mình chưa giải được bài này. </p>
<p><strong>Update:</strong> Mình vừa nhận ra mình đã bỏ lỡ một chi tiết quan trọng, đó là <strong>thời gian</strong>. Chúng ta có dữ kiện rằng <code># approx. time around 30µs when entering else&#39;s segment</code>, trong file thông tin bắt được, ta thấy mỗi lần tính <em>shared secret</em> key cần <code>10743.747201579188microse</code>, chia cho 30 thu được <code>358.1249067193063</code> vòng: <code>244</code> vòng chạy mã hóa (vì sk dài 244 bit), <code>114</code> vòng cộng (bit 1) và thời gian xuất  rất nhỏ. Trong đoạn bit vừa bắt được có <code>111</code> bit , do đó việc chúng ta cần làm là điền <code>3</code> bit  vào trong chỗ còn thiếu -&gt; thời tới.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pk = <span class="number">38483999891907407175443591517451416704302242042818884161505760394826326870371</span></span><br><span class="line"></span><br><span class="line">unknow_idx = [<span class="number">238</span>, <span class="number">236</span>, <span class="number">234</span>, <span class="number">229</span>, <span class="number">217</span>, <span class="number">212</span>, <span class="number">210</span>, <span class="number">195</span>, <span class="number">194</span>, <span class="number">190</span>, <span class="number">168</span>, <span class="number">165</span>, <span class="number">155</span>, <span class="number">142</span>, <span class="number">133</span>, <span class="number">129</span>, <span class="number">128</span>, <span class="number">112</span>, <span class="number">111</span>, <span class="number">110</span>, <span class="number">106</span>, <span class="number">96</span>, <span class="number">91</span>, <span class="number">82</span>, <span class="number">78</span>, <span class="number">76</span>, <span class="number">75</span>, <span class="number">74</span>, <span class="number">72</span>, <span class="number">71</span>, <span class="number">69</span>, <span class="number">64</span>, <span class="number">60</span>, <span class="number">58</span>, <span class="number">49</span>, <span class="number">47</span>, <span class="number">41</span>, <span class="number">32</span>, <span class="number">30</span>, <span class="number">29</span>, <span class="number">26</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">4</span>]</span><br><span class="line">sk = <span class="built_in">int</span>(<span class="string">&quot;00001111101000001001001010101101011010101011111110110010101100011011110110011010000011110010000110000111100101101000010011111000001001000000001001010100111100101000100100000010000111001000001010010100011111010111010000010010011111000011010110000111&quot;</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(unknow_idx)-<span class="number">2</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, <span class="built_in">len</span>(unknow_idx)-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(j + <span class="number">1</span>, <span class="built_in">len</span>(unknow_idx)):</span><br><span class="line">            s = sk</span><br><span class="line">        </span><br><span class="line">            t = (<span class="number">1</span> &lt;&lt; unknow_idx[i]) ^ (<span class="number">1</span> &lt;&lt; unknow_idx[j]) ^ (<span class="number">1</span> &lt;&lt; unknow_idx[k])</span><br><span class="line">            l = s ^ t</span><br><span class="line">            <span class="keyword">if</span> double_and_add(G, l).x == pk:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;l = &quot;</span>, l)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>Ta lúc này đã tìm được <em>sk</em>, và việc gì tới cũng phải tới :D</p>
<figure class="highlight python"><figcaption><span>Sagemath</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Leo_pk_x = <span class="number">31663442885885219669071274428005652588471134165143253841118506078548146970109</span></span><br><span class="line"></span><br><span class="line">Leo_pk_x = E.lift_x(Leo_pk_x)</span><br><span class="line"><span class="built_in">print</span>(Leo_pk_x)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sk = <span class="number">27610939802316035421304285370883343604756496045638121948548836716464321927</span></span><br><span class="line">leonard_pk_x = <span class="number">31663442885885219669071274428005652588471134165143253841118506078548146970109</span></span><br><span class="line">leonard_pk_y = <span class="number">76156276912437516602584683740575357964060179918140758336762510346991347147838</span></span><br><span class="line">leonard_public_point = Point(leonard_pk_x, leonard_pk_y)</span><br><span class="line">shared_secret_key = double_and_add(leonard_public_point, sk).x</span><br><span class="line">derived_aes_key = sha256(<span class="built_in">str</span>(shared_secret_key).encode(<span class="string">&#x27;ascii&#x27;</span>)).digest()</span><br><span class="line"></span><br><span class="line">iv = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;2db22c78c2ed85ca292cd68abe025abc&quot;</span>)</span><br><span class="line">ct = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;b4a5e98ab7e8f092dcacf1798bd6c95972c5a06b3a9caa537bcdf872f7da46ce&quot;</span>)</span><br><span class="line"></span><br><span class="line">cipher = AES.new(derived_aes_key, AES.MODE_CBC, iv)</span><br><span class="line">pt = cipher.decrypt(ct)</span><br><span class="line"><span class="built_in">print</span>(pt)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dvCTF&#123;7h3_Cl0ck_1s_71ck1n9!&#125;</span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>DavinciCTF 2023 Write-ups</p><p><a href="https://pinox0x0.github.io/2023/davinci-ctf-2023/">https://pinox0x0.github.io/2023/davinci-ctf-2023/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Pinox0x0</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2023-03-13</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-03-25</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/crypto/">crypto</a><a class="link-muted mr-2" rel="tag" href="/tags/CTF/">CTF</a><a class="link-muted mr-2" rel="tag" href="/tags/WriteUp/">WriteUp</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/wolv-ctf-2023-write-ups/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">WolvCTF 2023 Write-ups</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/pragyan-ctf-2023-write-ups/"><span class="level-item">Pragyan CTF 2023 Write-ups</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Pinox0x0"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Pinox0x0</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">4</p></a></div></div></nav></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#Welcome"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Welcome</span></span></a></li></ul><li><a class="level is-mobile" href="#Crypto"><span class="level-left"><span class="level-item">2</span><span class="level-item">Crypto</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Vigenere-XOR-easy-100"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Vigenere XOR (easy, 100)</span></span></a></li><li><a class="level is-mobile" href="#Desintegrated-RSA-crypto-100"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Desintegrated RSA (crypto, 100)</span></span></a></li><li><a class="level is-mobile" href="#Personal-key-easy-484"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">Personal key (easy, 484)</span></span></a></li><li><a class="level is-mobile" href="#Da-Vinci’s-Clock-medium-500"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">Da Vinci’s Clock (medium, 500)</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Pinox0x0&#039;s Blog</a><p class="is-size-7"><span>&copy; 2023 Pinox0x0</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2023 Pinox0x0</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>
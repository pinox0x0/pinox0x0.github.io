<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>WolvCTF 2023 Write-ups - Pinox&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Pinox&#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Pinox&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Lại là mình pinox đây :D Giải lần này mình làm được 4&amp;#x2F;5 bài Crypto (mảng chính của mình), mình đồng thời cũng làm được một số bài ở mảng khác, cũng khá là may mắn. Dưới đây là write-up của mình"><meta property="og:type" content="blog"><meta property="og:title" content="WolvCTF 2023 Write-ups"><meta property="og:url" content="https://pinox0x0.github.io/2023/wolv-ctf-2023-write-ups/"><meta property="og:site_name" content="Pinox&#039;s Blog"><meta property="og:description" content="Lại là mình pinox đây :D Giải lần này mình làm được 4&amp;#x2F;5 bài Crypto (mảng chính của mình), mình đồng thời cũng làm được một số bài ở mảng khác, cũng khá là may mắn. Dưới đây là write-up của mình"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://pinox0x0.github.io/src/2023/WolvCTF-2023/wolvctf-2023-result.jpg"><meta property="og:image" content="https://pinox0x0.github.io/src/2023/WolvCTF-2023/rock-you-zip.jpg"><meta property="article:published_time" content="2023-03-21T09:00:00.000Z"><meta property="article:modified_time" content="2023-03-24T21:59:43.915Z"><meta property="article:author" content="Pinox0x0"><meta property="article:tag" content="crypto"><meta property="article:tag" content="CTF"><meta property="article:tag" content="WriteUp"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://pinox0x0.github.io/src/2023/WolvCTF-2023/wolvctf-2023-result.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://pinox0x0.github.io/2023/wolv-ctf-2023-write-ups/"},"headline":"WolvCTF 2023 Write-ups","image":["https://pinox0x0.github.io/src/2023/WolvCTF-2023/wolvctf-2023-result.jpg","https://pinox0x0.github.io/src/2023/WolvCTF-2023/rock-you-zip.jpg"],"datePublished":"2023-03-21T09:00:00.000Z","dateModified":"2023-03-24T21:59:43.915Z","author":{"@type":"Person","name":"Pinox0x0"},"publisher":{"@type":"Organization","name":"Pinox's Blog","logo":{"@type":"ImageObject","url":{"text":"Pinox0x0's Blog"}}},"description":"Lại là mình pinox đây :D Giải lần này mình làm được 4&#x2F;5 bài Crypto (mảng chính của mình), mình đồng thời cũng làm được một số bài ở mảng khác, cũng khá là may mắn. Dưới đây là write-up của mình"}</script><link rel="canonical" href="https://pinox0x0.github.io/2023/wolv-ctf-2023-write-ups/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Pinox0x0&#039;s Blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/tools">Tools</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-03-21T09:00:00.000Z" title="12:00:00 21/3/2023">2023-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-03-24T21:59:43.915Z" title="00:59:43 25/3/2023">2023-03-25</time></span><span class="level-item"><a class="link-muted" href="/categories/CTF-Write-ups/">CTF Write-ups</a></span><span class="level-item">19 minutes read (About 2789 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">WolvCTF 2023 Write-ups</h1><div class="content"><p><img src="/src/2023/WolvCTF-2023/wolvctf-2023-result.jpg"></p>
<p>Lại là mình pinox đây :D Giải lần này mình làm được 4&#x2F;5 bài Crypto (mảng chính của mình), mình đồng thời cũng làm được một số bài ở mảng khác, cũng khá là may mắn. Dưới đây là write-up của mình về những bài mình đã làm được (Chỉ <strong>Crypto</strong>).</p>
<span id="more"></span>

<h2 id="Sanity-Check-50"><a href="#Sanity-Check-50" class="headerlink" title="Sanity Check (50)"></a>Sanity Check (50)</h2><blockquote>
<p>Join the <a target="_blank" rel="noopener" href="https://discord.gg/KZcXQqbn8y">Discord</a> and read the rules!</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;w3lc0m3_t0_w0lvctf_2023&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Beginer"><a href="#Beginer" class="headerlink" title="Beginer"></a>Beginer</h1><h2 id="yowhatsthepassword-50"><a href="#yowhatsthepassword-50" class="headerlink" title="yowhatsthepassword (50)"></a>yowhatsthepassword (50)</h2><blockquote>
<p>hey I lost the password :(</p>
</blockquote>
<figure class="highlight python"><figcaption><span>main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># I&#x27;m thinking of a number from 0 to 2^32 - 1</span></span><br><span class="line"><span class="comment"># Can you guess it?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate</span>(<span class="params">seed</span>):</span><br><span class="line">  random.seed(seed)</span><br><span class="line">  c = <span class="number">0</span></span><br><span class="line">  <span class="keyword">while</span> c != <span class="built_in">ord</span>(<span class="string">&#x27;&#125;&#x27;</span>):</span><br><span class="line">    c = random.randint(<span class="number">97</span>, <span class="number">126</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(c), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">secret = <span class="string">&#x27;ly9ppw==&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">s = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;password? &gt;&gt;&gt; &quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">int</span>(base64.b64decode(secret).<span class="built_in">hex</span>(), <span class="number">16</span>) == s:</span><br><span class="line">  generate(s)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;nope&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>Bài dành cho beginner nên cũng không có gì cả, đơn giản là decode secret ra số là được.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;ywtp&#125;</span><br></pre></td></tr></table></figure>

<h2 id="theyseemerolling-50"><a href="#theyseemerolling-50" class="headerlink" title="theyseemerolling (50)"></a>theyseemerolling (50)</h2><blockquote>
<p>they hatin my cryptosystem</p>
</blockquote>
<figure class="highlight python"><figcaption><span>enc.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">key = os.urandom(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_block</span>(<span class="params">block</span>):</span><br><span class="line">  <span class="keyword">return</span> strxor(key, block)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">pt</span>):</span><br><span class="line">  ct = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(pt), <span class="number">4</span>):</span><br><span class="line">    index = long_to_bytes(i // <span class="number">4</span>)</span><br><span class="line">    index = <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">4</span> - <span class="built_in">len</span>(index)) + index</span><br><span class="line">    ct += encrypt_block(index + pt[i:i+<span class="number">4</span>])</span><br><span class="line">  <span class="keyword">return</span> ct</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  flag = <span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">  flag += <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">4</span> - <span class="built_in">len</span>(flag) % <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(encrypt(flag).<span class="built_in">hex</span>())</span><br></pre></td></tr></table></figure>

<p>Chỉ là 1 bài XOR Trick đơn giản.</p>
<figure class="highlight python"><figcaption><span>solver.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"></span><br><span class="line">known_pt = <span class="string">b&quot;\x00\x00\x00\x00wctf&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_block</span>(<span class="params">k, block</span>):</span><br><span class="line">  <span class="keyword">return</span> strxor(k, block)</span><br><span class="line"></span><br><span class="line">ct = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;983f687f03f884a9983f687e0ff2afbc983f687d03a891bd983f687c2bf68990983f687b04e9c0a9983f687a2be8c4a6983f687910c482ff983f687818f7afb6983f687744ee8290983f687644ec9e90983f687517e989bf983f687400ab8dcf&quot;</span>)</span><br><span class="line"></span><br><span class="line">key = encrypt_block(ct[:<span class="number">8</span>], known_pt)</span><br><span class="line"></span><br><span class="line">pt = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(ct),<span class="number">8</span>):</span><br><span class="line">    pt += encrypt_block(key, ct[i: i + <span class="number">8</span>])[<span class="number">4</span>:]</span><br><span class="line"><span class="built_in">print</span>(pt)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;i_sw3ar_my_pr0f_s4id_r0ll_y0ur_0wn_crypt0&#125;</span><br></pre></td></tr></table></figure>

<h2 id="We-Will-Rock-You-50"><a href="#We-Will-Rock-You-50" class="headerlink" title="We Will Rock You (50)"></a>We Will Rock You (50)</h2><blockquote>
<p>Hey! Here’s the code for your free tickets to the rock concert! I just can’t remember what I made the password…</p>
</blockquote>
<p>Sử dụng công cụ <code>fcrackzip</code> và wordlist <code>rockyou.txt</code> để brute:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fcrackzip -v -D -u -p /usr/share/wordlists/rockyou.txt we_will_rock_you.zip</span><br></pre></td></tr></table></figure>

<p><img src="/src/2023/WolvCTF-2023/rock-you-zip.jpg"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;m1cH1g4n_4_3v3R&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="keyexchange-127"><a href="#keyexchange-127" class="headerlink" title="keyexchange (127)"></a>keyexchange (127)</h2><blockquote>
<p>Diffie-Hellman is secure right<br><code>nc keyexchange.wolvctf.io 1337</code></p>
</blockquote>
<figure class="highlight python"><figcaption><span>challenge.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/opt/homebrew/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">n = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">s = getPrime(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">a = getPrime(<span class="number">256</span>)</span><br><span class="line"><span class="comment"># n can&#x27;t hurt me if i don&#x27;t tell you</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(s, a, n))</span><br><span class="line">b = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;b? &gt;&gt;&gt; &quot;</span>))</span><br><span class="line"></span><br><span class="line">secret_key = <span class="built_in">pow</span>(<span class="built_in">pow</span>(s, a, n), b, n)</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">key = long_to_bytes(secret_key)</span><br><span class="line">enc = strxor(flag + <span class="string">b&#x27;\x00&#x27;</span> * (<span class="built_in">len</span>(key) - <span class="built_in">len</span>(flag)), key)</span><br><span class="line"><span class="built_in">print</span>(enc.<span class="built_in">hex</span>())</span><br></pre></td></tr></table></figure>

<p>Trick rất đơn giản: chọn <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">b = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> và chúng ta có ngay <em>secret_key</em>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;keyexchange.wolvctf.io&quot;</span>, <span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line">r.recvline().decode().strip()</span><br><span class="line">key = long_to_bytes(<span class="built_in">int</span>(r.recvline().decode().strip(), <span class="number">10</span>))</span><br><span class="line">r.sendlineafter(<span class="string">b&quot;b? &gt;&gt;&gt; &quot;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">ct = <span class="built_in">bytes</span>.fromhex(r.recvline().decode().strip())</span><br><span class="line">flag = strxor(ct, key)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;m4th_1s_h4rd_but_tru5t_th3_pr0c3ss&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Z2kDH-466"><a href="#Z2kDH-466" class="headerlink" title="Z2kDH (466)"></a>Z2kDH (466)</h2><blockquote>
<p>Sick of how slow it is to take the modulus of a large prime number? Tired of performing exponentiation over some weird group like <code>ed25519</code>? Just use the integers mod <code>2^k</code> group with the unit <code>g = 5</code>! Efficient, reliable, doesn’t require any hard math!</p>
</blockquote>
<p>Tác giả của comment trong <a target="_blank" rel="noopener" href="https://crypto.stackexchange.com/questions/43815/discrete-logarithm-algorithm-for-modulus-power-of-2">link</a> đã giải thích chi tiết về thuật toán nên mình không giải thích nhiều nữa.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">modulus = <span class="number">1</span> &lt;&lt; <span class="number">258</span></span><br><span class="line">e = <span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_secret_key</span>(<span class="params">pulic_key</span>):</span><br><span class="line">    s = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">1</span>, <span class="number">257</span>):</span><br><span class="line">        b = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">            b = b * <span class="number">2</span> + s[<span class="built_in">len</span>(s) - <span class="number">1</span> - j]</span><br><span class="line">        ba = <span class="built_in">pow</span>(<span class="built_in">pow</span>(<span class="number">5</span>, b, modulus), <span class="number">1</span> &lt;&lt; (e - i), modulus)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">pow</span>(pulic_key, <span class="number">1</span> &lt;&lt; (e - i), modulus) == ba:</span><br><span class="line">            s.append(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            s.append(<span class="number">1</span>)</span><br><span class="line">    s = s[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    out = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> s:</span><br><span class="line">        out = (out &lt;&lt; <span class="number">1</span>) | bit</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line">pa = <span class="built_in">int</span>(<span class="string">&quot;99edb8ed8892c664350acbd5d35346b9b77dedfae758190cd0544f2ea7312e81&quot;</span>, <span class="number">16</span>) * <span class="number">4</span> + <span class="number">1</span></span><br><span class="line">pb = <span class="built_in">int</span>(<span class="string">&quot;40716941a673bbda0cc8f67fdf89cd1cfcf22a92fe509411d5fd37d4cb926afd&quot;</span>, <span class="number">16</span>) * <span class="number">4</span> + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">sb = get_secret_key(pb)</span><br><span class="line">shared_key = <span class="built_in">pow</span>(pa, sb, modulus) // <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(shared_key))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;P0HL1G_H3LLM4N_$M4LL_pr1M3&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Galois-t-is-this-495"><a href="#Galois-t-is-this-495" class="headerlink" title="Galois-t is this? (495)"></a>Galois-t is this? (495)</h2><blockquote>
<p>I’m expecting a super secret message… If you can give it to me, I’ll give you a flag!<br><code>nc galois.wolvctf.io 1337</code></p>
</blockquote>
<figure class="highlight python"><figcaption><span>server.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GF_mult</span>(<span class="params">x, y</span>):</span><br><span class="line">    product = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">127</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        product ^= x * ((y &gt;&gt; i) &amp; <span class="number">1</span>)</span><br><span class="line">        x = (x &gt;&gt; <span class="number">1</span>) ^ ((x &amp; <span class="number">1</span>) * <span class="number">0xE1000000000000000000000000000000</span>)</span><br><span class="line">    <span class="keyword">return</span> product</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">H_mult</span>(<span class="params">H, val</span>):</span><br><span class="line">    product = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        product ^= GF_mult(H, (val &amp; <span class="number">0xFF</span>) &lt;&lt; (<span class="number">8</span> * i))</span><br><span class="line">        val &gt;&gt;= <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> product</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GHASH</span>(<span class="params">H, A, C</span>):</span><br><span class="line">    C_len = <span class="built_in">len</span>(C)</span><br><span class="line">    A_padded = bytes_to_long(A + <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">16</span> - <span class="built_in">len</span>(A) % <span class="number">16</span>))</span><br><span class="line">    <span class="keyword">if</span> C_len % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">        C += <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">16</span> - C_len % <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    tag = H_mult(H, A_padded)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(C) // <span class="number">16</span>):</span><br><span class="line">        tag ^= bytes_to_long(C[i*<span class="number">16</span>:i*<span class="number">16</span>+<span class="number">16</span>])</span><br><span class="line">        tag = H_mult(H, tag)</span><br><span class="line"></span><br><span class="line">    tag ^= bytes_to_long((<span class="number">8</span>*<span class="built_in">len</span>(A)).to_bytes(<span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>) + (<span class="number">8</span>*C_len).to_bytes(<span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">    tag = H_mult(H, tag)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tag</span><br><span class="line"></span><br><span class="line">FLAG = <span class="string">&quot;wctf&#123;This_is_fake_flag&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 128-bit blocks</span></span><br><span class="line">AES_BLOCK_SIZE = <span class="number">16</span></span><br><span class="line">key = get_random_bytes(<span class="number">16</span>)</span><br><span class="line">header = <span class="string">b&#x27;WolvCTFCertified&#x27;</span></span><br><span class="line">message = <span class="string">b&#x27;heythisisasupersecretsupersecret&#x27;</span></span><br><span class="line">used_nonces = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">incr</span>(<span class="params">counter</span>):</span><br><span class="line">    temp = bytes_to_long(counter)</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(temp + <span class="number">1</span>, <span class="number">16</span>)[-<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_nonce</span>(<span class="params">nonce</span>):</span><br><span class="line">    <span class="comment"># if you can&#x27;t reuse the nonce, surely you can&#x27;t explot this oracle!</span></span><br><span class="line">    <span class="keyword">if</span>(nonce <span class="keyword">in</span> used_nonces):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Sorry, a number used once can&#x27;t be used twice!&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    used_nonces.add(nonce)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">nonce, pt</span>):</span><br><span class="line">    pt = <span class="built_in">bytes</span>.fromhex(pt)</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">len</span>(pt) % <span class="number">16</span> == <span class="number">0</span>)</span><br><span class="line">    numBlocks = <span class="built_in">len</span>(pt) // AES_BLOCK_SIZE</span><br><span class="line">    <span class="keyword">if</span>(numBlocks &gt; <span class="number">3</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Sorry, we just don&#x27;t have the resources to encrypt a message that long!&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    nonce = <span class="built_in">bytes</span>.fromhex(nonce)</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">len</span>(nonce) == <span class="number">16</span>)</span><br><span class="line">    check_nonce(nonce)</span><br><span class="line"></span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    hkey = cipher.encrypt(<span class="string">b&#x27;\0&#x27;</span> * <span class="number">16</span>)</span><br><span class="line">    enc = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(numBlocks + <span class="number">1</span>):</span><br><span class="line">        enc += cipher.encrypt(nonce)</span><br><span class="line">        <span class="comment"># the counter is just the nonce, right? right??</span></span><br><span class="line">        nonce = incr(nonce)</span><br><span class="line"></span><br><span class="line">    ct = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, numBlocks + <span class="number">1</span>):</span><br><span class="line">        ct += strxor(</span><br><span class="line">            enc[i * AES_BLOCK_SIZE: (i+<span class="number">1</span>) * AES_BLOCK_SIZE],</span><br><span class="line">            pt[(i-<span class="number">1</span>) * AES_BLOCK_SIZE: i * AES_BLOCK_SIZE])</span><br><span class="line">        </span><br><span class="line">    authTag = strxor(</span><br><span class="line">        enc[:AES_BLOCK_SIZE],</span><br><span class="line">        long_to_bytes(GHASH(bytes_to_long(hkey), header, ct)))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ct.<span class="built_in">hex</span>(), authTag.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">nonce, ct, tag</span>):</span><br><span class="line">    ct = <span class="built_in">bytes</span>.fromhex(ct)</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">len</span>(ct) % <span class="number">16</span> == <span class="number">0</span>)</span><br><span class="line">    numBlocks = <span class="built_in">len</span>(ct) // AES_BLOCK_SIZE</span><br><span class="line"></span><br><span class="line">    nonce = <span class="built_in">bytes</span>.fromhex(nonce)</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">len</span>(nonce) == <span class="number">16</span>)</span><br><span class="line">    check_nonce(nonce)</span><br><span class="line"></span><br><span class="line">    tag = <span class="built_in">bytes</span>.fromhex(tag)</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">len</span>(tag) == <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    hkey = cipher.encrypt(<span class="string">b&#x27;\0&#x27;</span> * <span class="number">16</span>)</span><br><span class="line">    enc = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(numBlocks + <span class="number">1</span>):</span><br><span class="line">        enc += cipher.encrypt(nonce)</span><br><span class="line">        <span class="comment"># the counter is just the nonce, right?</span></span><br><span class="line">        nonce = incr(nonce)</span><br><span class="line"></span><br><span class="line">    pt = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, numBlocks + <span class="number">1</span>):</span><br><span class="line">        pt += strxor(</span><br><span class="line">            enc[i * AES_BLOCK_SIZE: (i+<span class="number">1</span>) * AES_BLOCK_SIZE],</span><br><span class="line">            ct[(i-<span class="number">1</span>) * AES_BLOCK_SIZE: i * AES_BLOCK_SIZE])</span><br><span class="line">        </span><br><span class="line">    authTag = strxor(</span><br><span class="line">        enc[:AES_BLOCK_SIZE],</span><br><span class="line">        long_to_bytes(GHASH(bytes_to_long(hkey), header, ct)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(pt == message):</span><br><span class="line">        <span class="keyword">if</span>(authTag == tag):</span><br><span class="line">            <span class="built_in">print</span>(FLAG)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Whoops, that doesn&#x27;t seem to be authentic!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Hmm, that&#x27;s not the message I was looking for...&quot;</span>)</span><br><span class="line"></span><br><span class="line">MENU = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1. Encrypt</span></span><br><span class="line"><span class="string">2. Submit</span></span><br><span class="line"><span class="string">3. Exit</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;If you can send me a valid super secret super secret I&#x27;ll give you a reward!&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(used_nonces) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">print</span>(MENU)</span><br><span class="line">        command = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">        <span class="keyword">match</span> command:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;1&quot;</span>:</span><br><span class="line">                nonce = <span class="built_in">input</span>(<span class="string">&quot;IV (hex) &gt; &quot;</span>)</span><br><span class="line">                pt = <span class="built_in">input</span>(<span class="string">&quot;Plaintext (hex) &gt; &quot;</span>)</span><br><span class="line">                ct, tag = encrypt(nonce, pt)</span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;CT: &quot;</span>, ct)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;TAG: &quot;</span>, tag)</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;2&quot;</span>:</span><br><span class="line">                nonce = <span class="built_in">input</span>(<span class="string">&quot;IV (hex) &gt; &quot;</span>)</span><br><span class="line">                ct = <span class="built_in">input</span>(<span class="string">&quot;Ciphertext (hex) &gt; &quot;</span>)</span><br><span class="line">                tag = <span class="built_in">input</span>(<span class="string">&quot;Tag (hex) &gt; &quot;</span>)</span><br><span class="line">                decrypt(nonce, ct, tag)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">case</span> other:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Bye!&quot;</span>)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;I know encryption is fun, but you can&#x27;t just keep doing it...&quot;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>Bài này thuộc kiểu XOR Trick, đề bài khá dài, tóm tắt như sau: Server cho chúng ta 3 lựa chọn:</p>
<ol>
<li><strong>Encrypt:</strong> Mã hóa <code>pt</code> với <code>IV</code> biết trước, trả về <code>ct</code> và <code>AuthTag</code>.</li>
<li><strong>Decrypt:</strong> Nhập <code>IV</code>, <code>ct</code> và <code>AuthTag</code>, kiểm tra nếu <code>ct == pt</code> biết trước và <code>AuthTag</code> chính xác khi mã hóa <code>pt</code> với <code>IV</code> thì trả về <code>Flag</code>.</li>
<li><strong>Exit:</strong> Dừng cuộc chơi.</li>
</ol>
<p>Đọc sơ qua về file mã nguồn, ta tóm tắt được như sau: (đối với trường hợp len(pt) &#x3D; 32 bytes)</p>
<ol>
<li>Cipher text <code>ct</code> có dạng:</li>
</ol>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>c</mi><mi>t</mi><mo>=</mo><mi>p</mi><mi>t</mi><mo>⊕</mo><mi>E</mi><mo stretchy="false">(</mo><mi>I</mi><mi>V</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>∥</mo><mi>E</mi><mo stretchy="false">(</mo><mi>I</mi><mi>V</mi><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> 
ct=pt\oplus E(IV+1)\parallel E(IV+2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span>

<ol start="2">
<li><code>AuthTag</code> có dạng:</li>
</ol>
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>t</mi><mi>a</mi><mi>g</mi><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><mi>I</mi><mi>V</mi><mo stretchy="false">)</mo><mo>⊕</mo><mi>H</mi><mi>A</mi><mi>S</mi><mi>H</mi><mrow><mo fence="true">(</mo><mi>E</mi><mo stretchy="false">(</mo><mover accent="true"><mn>0</mn><mo stretchy="true">‾</mo></mover><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mi>c</mi><mi>t</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex"> 
tag=E(IV)\oplus HASH\left(E(\overline{0}),header,ct\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord overline"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8444400000000001em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.76444em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span></span>

<p>Với lựa chọn <code>pt</code> và <code>IV</code> hợp lý (ta được phép chọn 2 lần), ta có thể tìm được giá trị  và tìm được <code>ct</code> và <code>AuthTag</code> tương ứng.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_checkTag</span>(<span class="params">i0, i1, i2, i3</span>):</span><br><span class="line">    ct = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    ct += i2 + i3</span><br><span class="line">    ct = strxor(ct, message)</span><br><span class="line"></span><br><span class="line">    authTag = strxor(i1, long_to_bytes(GHASH(bytes_to_long(i0), header, ct)))</span><br><span class="line">    <span class="keyword">return</span> ct.<span class="built_in">hex</span>(), authTag.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">header = <span class="string">b&#x27;WolvCTFCertified&#x27;</span></span><br><span class="line">hex_pt = <span class="string">&quot;6865797468697369736173757065727365637265747375706572736563726574&quot;</span> </span><br><span class="line">message = <span class="string">b&#x27;heythisisasupersecretsupersecret&#x27;</span> </span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;galois.wolvctf.io&quot;</span>, <span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line">_iv0 = <span class="string">&quot;ffffffffffffffffffffffffffffffff&quot;</span></span><br><span class="line">r.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&quot;IV (hex) &gt; &quot;</span>, _iv0)</span><br><span class="line">r.sendlineafter(<span class="string">b&quot;Plaintext (hex) &gt; &quot;</span>, hex_pt)</span><br><span class="line">ct1 = <span class="built_in">bytes</span>.fromhex(r.recvline().decode().strip()[<span class="number">4</span>:])</span><br><span class="line">tg1 = <span class="built_in">bytes</span>.fromhex(r.recvline().decode().strip()[<span class="number">5</span>:])</span><br><span class="line"></span><br><span class="line">_iv2 =  <span class="string">&quot;00000000000000000000000000000002&quot;</span></span><br><span class="line">r.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&quot;IV (hex) &gt; &quot;</span>, _iv2)</span><br><span class="line">r.sendlineafter(<span class="string">b&quot;Plaintext (hex) &gt; &quot;</span>, hex_pt)</span><br><span class="line">ct3 = <span class="built_in">bytes</span>.fromhex(r.recvline().decode().strip()[<span class="number">4</span>:])</span><br><span class="line">tg3 = <span class="built_in">bytes</span>.fromhex(r.recvline().decode().strip()[<span class="number">5</span>:])</span><br><span class="line"></span><br><span class="line">iv0 = strxor(ct1[:<span class="number">16</span>], message[:<span class="number">16</span>])</span><br><span class="line">iv1 = strxor(ct1[<span class="number">16</span>:], message[<span class="number">16</span>:])</span><br><span class="line">iv3 = strxor(ct3[:<span class="number">16</span>], message[:<span class="number">16</span>])</span><br><span class="line">iv4 = strxor(ct3[<span class="number">16</span>:], message[<span class="number">16</span>:])</span><br><span class="line">iv2 = strxor(tg3, long_to_bytes(GHASH(bytes_to_long(iv0), header, ct3)))</span><br><span class="line"></span><br><span class="line">ct4, tag = gen_checkTag(iv0, iv1, iv2, iv3)</span><br><span class="line"></span><br><span class="line">_iv1 = <span class="string">&quot;00000000000000000000000000000001&quot;</span></span><br><span class="line">r.sendlineafter(<span class="string">b&quot;&gt; &quot;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">b&quot;IV (hex) &gt; &quot;</span>, _iv1)</span><br><span class="line">r.sendlineafter(<span class="string">b&quot;Ciphertext (hex) &gt; &quot;</span>, ct4.encode())</span><br><span class="line">r.sendlineafter(<span class="string">b&quot;Tag (hex) &gt; &quot;</span>, tag.encode())</span><br><span class="line"></span><br><span class="line">flag = r.recvline().decode().strip()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;th13_sup3r_s3cr3t_13nt_v3ry_s3cr3t&#125;</span><br></pre></td></tr></table></figure>

<h2 id="DownUnder-497"><a href="#DownUnder-497" class="headerlink" title="DownUnder (497)"></a>DownUnder (497)</h2><blockquote>
<p>I sure hope nobody goes down on me… Make sure to gobble down our cookies though.<br><a target="_blank" rel="noopener" href="https://down-under-tlejfksioa-ul.a.run.app/">https://down-under-tlejfksioa-ul.a.run.app/</a></p>
</blockquote>
<figure class="highlight python"><figcaption><span>key_exchange.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">from</span> json <span class="keyword">import</span> loads</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> hmac <span class="keyword">import</span> new</span><br><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> uuid4</span><br><span class="line"><span class="keyword">from</span> generate <span class="keyword">import</span> generate</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">key = &#123;</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span> : <span class="number">0</span> , <span class="string">&#x27;1&#x27;</span> : <span class="number">1</span> , <span class="string">&#x27;2&#x27;</span> : <span class="number">2</span> , <span class="string">&#x27;3&#x27;</span> : <span class="number">3</span> , <span class="string">&#x27;4&#x27;</span> : <span class="number">4</span> , <span class="string">&#x27;5&#x27;</span> : <span class="number">5</span> , <span class="string">&#x27;6&#x27;</span> : <span class="number">6</span> ,</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span> : <span class="number">70</span>, <span class="string">&#x27;b&#x27;</span> : <span class="number">71</span>, <span class="string">&#x27;c&#x27;</span> : <span class="number">72</span>, <span class="string">&#x27;d&#x27;</span> : <span class="number">73</span>, <span class="string">&#x27;e&#x27;</span> : <span class="number">74</span>, <span class="string">&#x27;f&#x27;</span> : <span class="number">75</span>, <span class="string">&#x27;g&#x27;</span> : <span class="number">76</span>, <span class="string">&#x27;h&#x27;</span> : <span class="number">77</span>, <span class="string">&#x27;i&#x27;</span> : <span class="number">78</span>, <span class="string">&#x27;j&#x27;</span> : <span class="number">79</span>, </span><br><span class="line">    <span class="string">&#x27;k&#x27;</span> : <span class="number">80</span>, <span class="string">&#x27;l&#x27;</span> : <span class="number">81</span>, <span class="string">&#x27;m&#x27;</span> : <span class="number">82</span>, <span class="string">&#x27;n&#x27;</span> : <span class="number">83</span>, <span class="string">&#x27;o&#x27;</span> : <span class="number">84</span>, <span class="string">&#x27;p&#x27;</span> : <span class="number">85</span>, <span class="string">&#x27;q&#x27;</span> : <span class="number">86</span>, <span class="string">&#x27;r&#x27;</span> : <span class="number">87</span>, <span class="string">&#x27;s&#x27;</span> : <span class="number">88</span>, <span class="string">&#x27;t&#x27;</span> : <span class="number">89</span>, </span><br><span class="line">    <span class="string">&#x27;u&#x27;</span> : <span class="number">90</span>, <span class="string">&#x27;v&#x27;</span> : <span class="number">91</span>, <span class="string">&#x27;w&#x27;</span> : <span class="number">92</span>, <span class="string">&#x27;x&#x27;</span> : <span class="number">93</span>, <span class="string">&#x27;y&#x27;</span> : <span class="number">94</span>, <span class="string">&#x27;z&#x27;</span> : <span class="number">95</span>, <span class="string">&#x27;_&#x27;</span> : <span class="number">96</span>, <span class="string">&#x27;&#123;&#x27;</span> : <span class="number">97</span>, <span class="string">&#x27;&#125;&#x27;</span> : <span class="number">98</span>, <span class="string">&#x27;!&#x27;</span> : <span class="number">99</span>, </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sessions = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytes_to_long_flag</span>(<span class="params">bytes_in</span>):</span><br><span class="line">    long_out = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> bytes_in:</span><br><span class="line">        long_out += <span class="built_in">str</span>(key[<span class="built_in">chr</span>(b)])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(long_out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">long_to_bytes_flag</span>(<span class="params">long_in</span>):</span><br><span class="line">    new_map = &#123;v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> key.items()&#125;</span><br><span class="line">    list_long_in = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>(long_in)]</span><br><span class="line">    str_out = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(list_long_in):</span><br><span class="line">        <span class="keyword">if</span> list_long_in[i] &lt; <span class="number">7</span>:</span><br><span class="line">            str_out += new_map[list_long_in[i]]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            str_out += new_map[<span class="built_in">int</span>(<span class="built_in">str</span>(list_long_in[i]) + <span class="built_in">str</span>(list_long_in[i + <span class="number">1</span>]))]</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> str_out.encode(<span class="string">&quot;utf_8&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">diffie_hellman</span>(<span class="params">A, g, b, p</span>):</span><br><span class="line">    B = <span class="built_in">pow</span>(g,b,p)</span><br><span class="line">    s = <span class="built_in">pow</span>(A,b,p)</span><br><span class="line">    message = <span class="string">b&#x27;My totally secure message to Alice&#x27;</span></span><br><span class="line">    password = long_to_bytes(s)</span><br><span class="line">    my_hmac = new(key=password, msg = message, digestmod=sha256)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(bytes_to_long(my_hmac.digest())), B</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    old_session = request.cookies.get(<span class="string">&#x27;session&#x27;</span>)</span><br><span class="line">    A = request.args.get(<span class="string">&#x27;A&#x27;</span>, <span class="built_in">type</span> = <span class="built_in">int</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(A, <span class="built_in">int</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Missing required query string parameter: A&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> old_session:</span><br><span class="line">        p, q, g = generate()</span><br><span class="line">        session = &#123;<span class="string">&quot;id&quot;</span>: uuid4().<span class="built_in">hex</span>, <span class="string">&#x27;p&#x27;</span>: p, <span class="string">&#x27;q&#x27;</span>: q, <span class="string">&#x27;g&#x27;</span>: g, <span class="string">&quot;attempts&quot;</span>: <span class="number">0</span>&#125;</span><br><span class="line">        sessions[session[<span class="string">&#x27;id&#x27;</span>]] = session</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> old_session <span class="keyword">not</span> <span class="keyword">in</span> sessions.keys():</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Invalid session&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> sessions[old_session][<span class="string">&#x27;attempts&#x27;</span>] &lt; <span class="number">7</span>:</span><br><span class="line">            sessions.pop(old_session)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Too many attempts&quot;</span></span><br><span class="line">        p, q, g, attempts = sessions[old_session][<span class="string">&#x27;p&#x27;</span>], sessions[old_session][<span class="string">&#x27;q&#x27;</span>], sessions[old_session][<span class="string">&#x27;g&#x27;</span>], sessions[old_session][<span class="string">&#x27;attempts&#x27;</span>]</span><br><span class="line">        session = &#123;<span class="string">&quot;id&quot;</span>: old_session, <span class="string">&#x27;p&#x27;</span>: p, <span class="string">&#x27;q&#x27;</span>: q, <span class="string">&#x27;g&#x27;</span>: g, <span class="string">&quot;attempts&quot;</span>: attempts + <span class="number">1</span>&#125;</span><br><span class="line">        sessions[old_session] = session</span><br><span class="line">    <span class="keyword">if</span> b &gt; q:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection reset&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        hmac, B = diffie_hellman(<span class="built_in">int</span>(A), g, b, p)</span><br><span class="line">        res = jsonify(&#123;<span class="string">&quot;hmac&quot;</span>: hmac, <span class="string">&quot;B&quot;</span>: B, <span class="string">&quot;p&quot;</span>: p, <span class="string">&quot;q&quot;</span>: q, <span class="string">&quot;g&quot;</span>: g&#125;)</span><br><span class="line">        res.set_cookie(<span class="string">&#x27;session&#x27;</span>, session[<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Internal error. A was: &quot;</span> + <span class="built_in">str</span>(A)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">flag = f.read().strip()</span><br><span class="line">b = bytes_to_long_flag(flag.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(port=<span class="number">54321</span>)</span><br></pre></td></tr></table></figure>

<p>Đọc qua thì đây lại là bài toán trao đổi khóa DHKE, tuy nhiên có một số điểm ta nhận thấy như sau:</p>
<ol>
<li>Khóa bí mật <em>b</em> được sử dụng nhiều lần.</li>
<li>Độ lớn của <code>bytes_to_long_flag(flag)</code> không vượt quá <em>q</em>, ta suy ra độ dài của nó khoảng 40 chữ số.</li>
<li>Số <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">b - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> có nhiều divisors nhỏ.</li>
</ol>
<p>Từ những dữ kiện này, ta nghĩ đến tấn công <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Pohlig%E2%80%93Hellman_algorithm">Pohlig–Hellman algorithm</a>. Sử dụng những cặp số <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>g</mi><mo separator="true">,</mo><msup><mi>g</mi><mi>b</mi></msup><mo separator="true">,</mo><mi>p</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(g, g^b, p) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.099108em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span></span> khác nhau (ở đây mình sử dụng 2 bộ) và CRT, ta nhanh chóng thu được khóa bí mật <em>b</em>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">F_p = [<span class="number">36131</span>,<span class="number">39161</span>,<span class="number">43063</span>,<span class="number">46073</span>,<span class="number">50873</span>,<span class="number">52301</span>]</span><br><span class="line">r = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> F_p:</span><br><span class="line">    q = (p - <span class="number">1</span>) // t</span><br><span class="line">    B1 = <span class="built_in">pow</span>(B, q, p)</span><br><span class="line">    g1 = <span class="built_in">pow</span>(g, q, p)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">pow</span>(g1, i, p) == B1:</span><br><span class="line">            r.append(i)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><figcaption><span>Sagemath</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">F_p = [<span class="number">36131</span>,<span class="number">39161</span>,<span class="number">43063</span>,<span class="number">46073</span>,<span class="number">50873</span>,<span class="number">52301</span>, <span class="number">19515162859827511106451680926</span>]</span><br><span class="line">r = [<span class="number">14792</span>, <span class="number">7728</span>, <span class="number">8980</span>, <span class="number">42070</span>, <span class="number">8849</span>, <span class="number">30172</span>, <span class="number">12902743557457970008807866582</span>]</span><br><span class="line"></span><br><span class="line">b = crt(r, F_p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytes_to_long_flag</span>(<span class="params">bytes_in</span>):</span><br><span class="line">    long_out = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> bytes_in:</span><br><span class="line">        long_out += <span class="built_in">str</span>(key[<span class="built_in">chr</span>(b)])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(long_out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">long_to_bytes_flag</span>(<span class="params">long_in</span>):</span><br><span class="line">    new_map = &#123;v: k <span class="keyword">for</span> k, v <span class="keyword">in</span> key.items()&#125;</span><br><span class="line">    list_long_in = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">str</span>(long_in)]</span><br><span class="line">    str_out = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(list_long_in):</span><br><span class="line">        <span class="keyword">if</span> list_long_in[i] &lt; <span class="number">7</span>:</span><br><span class="line">            str_out += new_map[list_long_in[i]]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            str_out += new_map[<span class="built_in">int</span>(<span class="built_in">str</span>(list_long_in[i]) + <span class="built_in">str</span>(list_long_in[i + <span class="number">1</span>]))]</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> str_out.encode(<span class="string">&quot;utf_8&quot;</span>)</span><br><span class="line"></span><br><span class="line">p = <span class="number">2115635612788314680423759533842276142188937827456317028096065273041055870280642066275286948329121712229597609188471055831220265463326525301446163712834147940052647264097207891095916335380576244626451390262378673945402653142119950219013539405730812529850482244791237562998027</span></span><br><span class="line">g = <span class="number">952301897016132751164848969282352795338459214964513051829166657742677405297778375105450145836227698217726356198830082748898262871130349651212793560505294122964009215059837865055555664469554395220315025018158971967825473597855461585261861881579238655661082289326040203660399</span></span><br><span class="line"></span><br><span class="line">B = <span class="number">213835255108491136865266315094809652114336655580595797170157304518249974206632214632639652513153034456183165945205323136611249731490416068087034176061118409571433147412425165996209507835070376993149257720952113379997189998254838152926130137297097132727035544312965351461374</span></span><br><span class="line"></span><br><span class="line">b = <span class="number">9272897597824931829082968138376897759998</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes_flag(b))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wctf&#123;m4x1mum_l3ngth5!&#125;</span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>WolvCTF 2023 Write-ups</p><p><a href="https://pinox0x0.github.io/2023/wolv-ctf-2023-write-ups/">https://pinox0x0.github.io/2023/wolv-ctf-2023-write-ups/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Pinox0x0</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2023-03-21</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-03-25</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/crypto/">crypto</a><a class="link-muted mr-2" rel="tag" href="/tags/CTF/">CTF</a><a class="link-muted mr-2" rel="tag" href="/tags/WriteUp/">WriteUp</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/davinci-ctf-2023/"><span class="level-item">DavinciCTF 2023 Write-ups</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Pinox0x0"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Pinox0x0</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">4</p></a></div></div></nav></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#Sanity-Check-50"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Sanity Check (50)</span></span></a></li></ul><li><a class="level is-mobile" href="#Beginer"><span class="level-left"><span class="level-item">2</span><span class="level-item">Beginer</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#yowhatsthepassword-50"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">yowhatsthepassword (50)</span></span></a></li><li><a class="level is-mobile" href="#theyseemerolling-50"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">theyseemerolling (50)</span></span></a></li><li><a class="level is-mobile" href="#We-Will-Rock-You-50"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">We Will Rock You (50)</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Crypto"><span class="level-left"><span class="level-item">3</span><span class="level-item">Crypto</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#keyexchange-127"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">keyexchange (127)</span></span></a></li><li><a class="level is-mobile" href="#Z2kDH-466"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Z2kDH (466)</span></span></a></li><li><a class="level is-mobile" href="#Galois-t-is-this-495"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">Galois-t is this? (495)</span></span></a></li><li><a class="level is-mobile" href="#DownUnder-497"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">DownUnder (497)</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Pinox0x0&#039;s Blog</a><p class="is-size-7"><span>&copy; 2023 Pinox0x0</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2023 Pinox0x0</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>